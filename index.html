<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#2c3e50">
  <title>Pinochle Scorer</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- ====== Header ====== -->
  <header class="app-header">
    <h1>Pinochle</h1>
    <div class="header-actions">
      <button class="btn-icon" id="btn-reset" title="New Game" aria-label="New Game">&#8634;</button>
      <button class="btn-icon" id="btn-theme" title="Toggle dark mode" aria-label="Toggle dark mode">&#9790;</button>
      <button class="btn-icon" id="btn-help" title="Help" aria-label="Help">?</button>
      <button class="btn-icon" id="btn-about" title="About" aria-label="About">&#9432;</button>
      <button class="btn-icon" id="btn-settings" title="Settings" aria-label="Settings">&#9881;</button>
    </div>
  </header>

  <div class="container">
    <!-- ====== Setup Screen ====== -->
    <div id="screen-setup" class="screen active">
      <!-- Player Count -->
      <div class="setup-section">
        <h2>Number of Players</h2>
        <div class="player-count-grid" id="player-count-grid">
          <button class="player-count-btn" data-count="2">2</button>
          <button class="player-count-btn" data-count="3">3</button>
          <button class="player-count-btn active" data-count="4">4</button>
          <button class="player-count-btn" data-count="5">5</button>
          <button class="player-count-btn" data-count="6">6</button>
          <button class="player-count-btn" data-count="7">7</button>
          <button class="player-count-btn" data-count="8">8</button>
        </div>
      </div>

      <!-- Deck Type -->
      <div class="setup-section" id="deck-type-section">
        <h2>Deck Type</h2>
        <div class="toggle-group">
          <button class="toggle-btn active" data-deck="single">Single (48)</button>
          <button class="toggle-btn" data-deck="64">64-Card</button>
          <button class="toggle-btn" data-deck="double">Double (80)</button>
        </div>
      </div>

      <!-- Game Type -->
      <div class="setup-section" id="game-type-section">
        <h2>Game Type</h2>
        <div class="toggle-group">
          <button class="toggle-btn active" data-gametype="individual">Individual</button>
          <button class="toggle-btn" data-gametype="partnership">Partnership</button>
        </div>
      </div>

      <!-- Scoring System -->
      <div class="setup-section">
        <h2>Scoring System</h2>
        <div class="toggle-group">
          <button class="toggle-btn active" data-scoring="classic">Classic</button>
          <button class="toggle-btn" data-scoring="simplified">Simplified</button>
        </div>
      </div>

      <!-- House Rules -->
      <div class="setup-section">
        <h2>House Rules</h2>
        <div class="toggle-group" id="house-rules-group">
          <button class="toggle-btn active" data-rules="standard">Standard</button>
          <button class="toggle-btn" data-rules="npa">NPA</button>
          <button class="toggle-btn" data-rules="custom">Custom</button>
        </div>

        <div class="custom-rules-panel" id="custom-rules-panel">
          <div class="custom-rule-row">
            <span>Dix Scoring</span>
            <label class="switch">
              <input type="checkbox" id="rule-dix" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="custom-rule-row">
            <span>Roundhouse as Meld</span>
            <label class="switch">
              <input type="checkbox" id="rule-roundhouse" checked>
              <span class="slider"></span>
            </label>
          </div>
          <div class="custom-rule-row">
            <span>Set Penalty</span>
            <select id="rule-set-penalty">
              <option value="lose-bid">Lose Bid Amount</option>
              <option value="lose-bid-meld">Lose Bid + Meld</option>
              <option value="lose-double-bid">Lose Double Bid</option>
            </select>
          </div>
          <div class="custom-rule-row">
            <span>Last Trick Bonus</span>
            <select id="rule-last-trick">
              <option value="0">0</option>
              <option value="10" selected>10</option>
              <option value="20">20</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Target Score -->
      <div class="setup-section">
        <h2>Target Score</h2>
        <input type="number" id="target-score" value="1000" inputmode="numeric" min="100" step="50">
      </div>

      <!-- Player Names -->
      <div class="setup-section">
        <h2>Players</h2>
        <div id="player-names-list"></div>
      </div>

      <!-- Partnership Teams (shown when partnership mode) -->
      <div class="setup-section hidden" id="partnership-section">
        <h2>Team Assignments</h2>
        <div id="team-assignments"></div>
      </div>

      <!-- Start Game -->
      <button class="btn btn-primary btn-lg" id="btn-start-game" style="width: 100%; margin-top: 8px;">
        Start Game
      </button>
    </div>

    <!-- ====== Game Screen ====== -->
    <div id="screen-game" class="screen game-screen">
      <!-- Scoreboard -->
      <div class="scoreboard" id="scoreboard">
        <div class="scoreboard-inner" id="scoreboard-inner"></div>
      </div>

      <!-- Phase Stepper -->
      <div class="phase-stepper" id="phase-stepper"></div>

      <!-- Phase Content -->
      <div class="phase-content" id="phase-content"></div>

      <!-- Game History -->
      <div class="game-history">
        <button class="history-toggle" id="history-toggle">
          <span>Round History</span>
          <span id="history-arrow">&#9660;</span>
        </button>
        <div class="history-content" id="history-content"></div>
      </div>
    </div>
  </div>

  <!-- ====== Bottom Action Bar ====== -->
  <div class="bottom-bar hidden" id="bottom-bar">
    <button class="btn btn-secondary" id="btn-undo">Undo</button>
    <button class="btn btn-primary" id="btn-next-phase">Next Phase &rarr;</button>
  </div>

  <!-- ====== Help Modal ====== -->
  <div class="modal-overlay" id="modal-help">
    <div class="modal">
      <button class="btn-icon modal-close" id="btn-close-help">&times;</button>
      <h2>Pinochle Quick Reference</h2>
      <div id="help-content">
        <div class="help-section-header">How to Play (2 Players)</div>
        <p><strong>No bidding</strong> &mdash; a trump suit is turned up from the deck each round.</p>
        <p>Each player melds from their hand, but may only choose <strong>one meld class</strong> per round:</p>
        <ul style="margin:6px 0 6px 20px; font-size:0.875rem;">
          <li><strong>Class A</strong> &mdash; Marriages, Runs &amp; Dix</li>
          <li><strong>Class B</strong> &mdash; Aces/Kings/Queens/Jacks Around</li>
          <li><strong>Class C</strong> &mdash; Pinochle</li>
        </ul>
        <p>Players take tricks and count card points. Both players score meld + tricks each round.</p>

        <div class="help-divider"></div>

        <div class="help-section-header">How to Play (3+ Players)</div>
        <p><strong>Bidding:</strong> Players bid on points they can earn. The highest bidder names trump and must meet their bid through meld + trick points or go SET.</p>
        <p><strong>Partnership:</strong> In 4+ player partnership games, teammates combine meld + tricks to meet the bid. All players may meld freely (no class restriction).</p>
        <p>All players score meld + tricks. The bidder risks losing their bid amount if SET.</p>

        <div class="help-divider"></div>

        <h3 class="mt-16">Deck Types</h3>
        <p style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;"><strong>Single (48)</strong>: A-10-K-Q-J-9 &times; 4 suits &times; 2 copies<br>
        <strong>64-Card</strong>: A-10-K-Q-J-9-8-7 &times; 4 suits &times; 2 copies<br>
        <strong>Double (80)</strong>: A-10-K-Q-J &times; 4 suits &times; 4 copies (no 9s)</p>

        <h3 class="mt-16">Meld Values (Single &amp; 64-Card Deck)</h3>
        <table style="width:100%; margin-top:8px; font-size:0.875rem;">
          <tr><td>Marriage (K+Q same suit)</td><td style="text-align:right">20</td></tr>
          <tr><td>Royal Marriage (K+Q of trump)</td><td style="text-align:right">40</td></tr>
          <tr><td>Run (A-10-K-Q-J of trump)</td><td style="text-align:right">150</td></tr>
          <tr><td>Pinochle (J&#9830; + Q&#9824;)</td><td style="text-align:right">40</td></tr>
          <tr><td>Dix (9 of trump)</td><td style="text-align:right">10</td></tr>
          <tr><td>Aces Around (A in each suit)</td><td style="text-align:right">100</td></tr>
          <tr><td>Kings Around (K in each suit)</td><td style="text-align:right">80</td></tr>
          <tr><td>Queens Around (Q in each suit)</td><td style="text-align:right">60</td></tr>
          <tr><td>Jacks Around (J in each suit)</td><td style="text-align:right">40</td></tr>
          <tr><td>Roundhouse (K+Q in all 4 suits)</td><td style="text-align:right">240</td></tr>
        </table>

        <h3 class="mt-16">Additional Melds (Double Deck)</h3>
        <p style="font-size:0.8rem; color:var(--text-muted); margin-top:4px;">Double deck = two Pinochle decks, no 9s (80 cards, 4 of each card). Dix is not available.</p>
        <table style="width:100%; margin-top:8px; font-size:0.875rem;">
          <tr><td>Double Pinochle (both J&#9830; + both Q&#9824;)</td><td style="text-align:right">300</td></tr>
          <tr><td>Triple Pinochle (3x J&#9830; + 3x Q&#9824;)</td><td style="text-align:right">600</td></tr>
          <tr><td>Quadruple Pinochle (4x J&#9830; + 4x Q&#9824;)</td><td style="text-align:right">1200</td></tr>
          <tr><td>Double Marriage (2x K+Q same suit)</td><td style="text-align:right">40</td></tr>
          <tr><td>Double Royal Marriage (2x K+Q of trump)</td><td style="text-align:right">80</td></tr>
          <tr><td>Double Run (2x A-10-K-Q-J of trump)</td><td style="text-align:right">1500</td></tr>
          <tr><td>Aces Abound (2x A in each suit)</td><td style="text-align:right">1000</td></tr>
          <tr><td>Kings Abound (2x K in each suit)</td><td style="text-align:right">800</td></tr>
          <tr><td>Queens Abound (2x Q in each suit)</td><td style="text-align:right">600</td></tr>
          <tr><td>Jacks Abound (2x J in each suit)</td><td style="text-align:right">400</td></tr>
        </table>

        <h3 class="mt-16">Card Point Values</h3>
        <table style="width:100%; margin-top:8px; font-size:0.875rem;">
          <tr><td>Ace</td><td style="text-align:right">11</td></tr>
          <tr><td>Ten</td><td style="text-align:right">10</td></tr>
          <tr><td>King</td><td style="text-align:right">4</td></tr>
          <tr><td>Queen</td><td style="text-align:right">3</td></tr>
          <tr><td>Jack</td><td style="text-align:right">2</td></tr>
        </table>

        <h3 class="mt-16">Going Set</h3>
        <p>If the bidder's meld + trick points don't meet their bid, they "go set" and lose points equal to their bid amount. In partnership, the entire team loses.</p>

        <h3 class="mt-16">Winning</h3>
        <p>First player/team to reach the target score wins!</p>
      </div>
    </div>
  </div>

  <!-- ====== Settings Modal ====== -->
  <div class="modal-overlay" id="modal-settings">
    <div class="modal">
      <button class="btn-icon modal-close" id="btn-close-settings">&times;</button>
      <h2>Settings</h2>
      <div class="flex flex-col gap-12">
        <button class="btn btn-secondary" id="btn-export" style="width:100%">Export Game (JSON)</button>
        <button class="btn btn-secondary" id="btn-import" style="width:100%">Import Game (JSON)</button>
        <input type="file" id="import-file" accept=".json" class="hidden">
        <hr style="border-color: var(--border-color)">
        <div id="cloud-save-section" class="hidden">
          <div id="cloud-sign-in-view">
            <button class="btn btn-secondary" id="cloud-sign-in-btn" style="width:100%">
              Sign in with Google
            </button>
          </div>
          <div id="cloud-signed-in" class="hidden">
            <div class="cloud-user-row">
              <span id="cloud-user-email"></span>
              <button class="btn btn-sm" id="cloud-sign-out-btn">Sign Out</button>
            </div>
            <div class="flex flex-col gap-8 mt-8">
              <button class="btn btn-primary" id="cloud-save-btn" style="width:100%">Save to Google Drive</button>
              <button class="btn btn-secondary" id="cloud-load-btn" style="width:100%">Load from Google Drive</button>
            </div>
            <div id="cloud-saves-list" class="hidden mt-8"></div>
            <div id="cloud-status" class="cloud-status"></div>
          </div>
        </div>
        <hr style="border-color: var(--border-color)">
        <button class="btn btn-danger" id="btn-new-game" style="width:100%">New Game</button>
      </div>
    </div>
  </div>

  <!-- ====== About Modal ====== -->
  <div class="modal-overlay" id="modal-about">
    <div class="modal">
      <button class="btn-icon modal-close" id="btn-close-about">&times;</button>
      <h2>About Pinochle Scorer</h2>
      <p style="margin-bottom:12px; color:var(--text-secondary);">A free score tracker for Pinochle card games. Supports 2-8 players, single and double decks, partnerships, and customizable house rules.</p>
      <p style="margin-bottom:16px; color:var(--text-secondary);">Built by <strong>Andre Fecto</strong>.</p>
      <div class="flex flex-col gap-8">
        <a href="https://github.com/andrefecto" target="_blank" rel="noopener noreferrer" class="btn btn-secondary about-link">
          <svg width="20" height="20" viewBox="0 0 16 16" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
          GitHub
        </a>
        <a href="https://buymeacoffee.com/andrefecto" target="_blank" rel="noopener noreferrer" class="btn btn-secondary about-link">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20.216 6.415l-.132-.666c-.119-.598-.388-1.163-1.001-1.379-.197-.069-.42-.098-.57-.241-.152-.143-.196-.366-.231-.572-.065-.378-.125-.756-.192-1.133-.057-.325-.102-.69-.25-.987-.195-.4-.597-.634-.996-.788a5.723 5.723 0 00-.626-.194c-1-.263-2.05-.36-3.077-.416a25.834 25.834 0 00-3.7.062c-.915.083-1.88.184-2.75.5-.318.116-.646.256-.888.501-.297.302-.393.77-.177 1.146.154.267.415.456.692.58.36.162.737.284 1.123.366 1.075.238 2.189.331 3.287.37 1.218.05 2.437.01 3.65-.118.299-.033.598-.073.896-.119.352-.054.578-.513.474-.834-.124-.383-.457-.531-.834-.473-.466.074-.96.108-1.382.146-1.177.08-2.358.082-3.536.006a22.228 22.228 0 01-1.157-.107c-.086-.01-.18-.025-.258-.036-.243-.036-.484-.08-.724-.13-.111-.027-.111-.185 0-.212h.005c.277-.06.557-.108.838-.147h.002c.131-.009.263-.032.394-.048a25.076 25.076 0 013.426-.12c.674.019 1.347.067 2.017.144l.228.031c.267.04.533.088.798.145.392.085.895.113 1.07.542.055.137.08.288.111.431l.319 1.484a.237.237 0 01-.199.284h-.003c-.037.006-.075.01-.112.015a36.704 36.704 0 01-4.743.295 37.059 37.059 0 01-4.699-.304c-.14-.017-.293-.042-.417-.06-.326-.048-.649-.108-.973-.161-.393-.065-.768-.032-1.123.161-.29.16-.502.451-.399.792.045.15.15.27.27.36l.344.282c.394.317.8.622 1.21.918 1.207.868 2.414 1.736 3.62 2.604.46.33.919.662 1.378.993.137.099.272.204.42.285.763.418 1.462.04 1.523-.755.06-.768-.393-1.402-.905-1.885-.512-.484-1.107-.89-1.695-1.273-.848-.553-1.696-1.107-2.544-1.66-.263-.172-.527-.343-.79-.515z"/><path d="M8.5 14a1 1 0 100 2 1 1 0 000-2zm7 0a1 1 0 100 2 1 1 0 000-2z"/><path d="M4 19h16v1a2 2 0 01-2 2H6a2 2 0 01-2-2v-1zm0-3h16v2H4v-2z"/></svg>
          Buy Me a Coffee
        </a>
      </div>
      <div style="margin-top:16px; padding-top:12px; border-top:1px solid var(--border-color);">
        <a href="privacy.html" style="font-size:0.8rem; color:var(--text-muted);">Privacy Policy</a>
      </div>
    </div>
  </div>

  <footer style="text-align:center; padding:16px; font-size:0.75rem; color:var(--text-muted);">
    <a href="privacy.html" style="color:var(--text-muted);">Privacy Policy</a>
  </footer>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="js/constants.js"></script>
  <script src="js/game-state.js"></script>
  <script src="js/ui-controller.js"></script>
  <script src="js/cloud-save.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
